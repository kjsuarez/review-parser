<form #keywordSearch="ngForm" ngNativeValidate class="container search-form">
  <div class="column-1">
    <mat-form-field class="search-input">
      <input
        matInput
        placeholder="app search"
        type="text"
        [(ngModel)]="searchKeyWord"
        (keyup)="updateSearch(keywordSearch)"
        name="searchKeyWord"
        [matAutocomplete]="auto">

        <mat-autocomplete #auto="matAutocomplete">
          <mat-option *ngFor="let application of this.foundApps" [value]="option" (click)="doApplicationThings(application, selectedRegion)">
            {{application.name}}
          </mat-option>
        </mat-autocomplete>

    </mat-form-field>

    <mat-spinner *ngIf="this.thinking"></mat-spinner>

    <div *ngIf="this.data_recieved" class="percentages">
      <div class="percentage-column">
        <h2>Bad reviews related <br> to power</h2>
        <h2 class="big-number">{{powerPercentage}}%</h2>
        <h3>{{powerCount}}/{{badReviewCount}}</h3>
      </div>
      <div class="percentage-column">
          <h2>Bad reviews related <br> to performance</h2>
          <h2 class="big-number">{{performancePercentage}}%</h2>
          <h3>{{performanceCount}}/{{badReviewCount}}</h3>
      </div>
    </div>

    <div *ngIf="this.data_recieved" class="details-data">
      <h3>total reviews pulled: {{totalReviewsCollected}}</h3>
      <h3> number of bad reviews (below 4 stars): {{badReviewCount}} ({{badReviewPercentage}}%)</h3>
      <br>
      <h3>keyword breakdown:</h3>

      <mat-grid-list cols="4" rowHeight="4:1" class="minutiae">
        <mat-grid-tile *ngFor="let keyword of visibleKeywords" (click)="selectRelevantReviews(keyword)">
          {{trim(keyword)}}: {{keywordStats[keyword]}} ({{percentOf(keywordStats[keyword], badReviewCount)}}%)
        </mat-grid-tile>

        <mat-grid-tile (click)="resetRelevantReviews()" class="reset-button"> reset </mat-grid-tile>
      </mat-grid-list>
    </div>

    <mat-accordion *ngIf="!this.sent_email && data_recieved">
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title> learn more </mat-panel-title>
          <mat-panel-description> Give us your email plz </mat-panel-description>
        </mat-expansion-panel-header>
        <mat-form-field>
          <input matInput [(ngModel)]="userEmail" name="userEmail" placeholder="email">
        </mat-form-field>
        <mat-action-row>
          <button mat-button color="primary" [disabled]="!validEmail(userEmail)" (click)="submitEmail(userEmail)">submit</button>
        </mat-action-row>
      </mat-expansion-panel>
    </mat-accordion>

    <div *ngIf="data_recieved" class="reviews">
      <div class="review-column-1">
        <h3 *ngIf="powerReviews.length == 0"> No bad reviews related to Power ðŸ™‚ </h3>
        <mat-paginator #powerPaginator
                      *ngIf="relevantPowerReviews.length > 0"
                      [length]="relevantPowerReviews.length"
                      [pageSize]="pageSize"
                      [pageSizeOptions]="pageSizeOptions"
                      (page)="onPowerPage($event)"
                      class="review-paginator">
        </mat-paginator>

        <div *ngIf="this.sent_email" class="power-reviews">
          <ul>
            <li *ngFor="let review of viewablePowerReviews; index as i;" class="review-item">
              <mat-icon *ngFor="let star of starArray(review.review.rating)" class=star-icon>star</mat-icon>
              <p > {{review.review.content}} </p>
              <div class="review-subtext">
                <p *ngFor="let keyword of review.keywords" > {{keyword}} </p>
              </div>
            </li>
          </ul>
        </div>
      </div>

      <div class="review-column-2">
        <h3 *ngIf="performanceReviews.length == 0"> No bad reviews related to Preformance ðŸ™‚ </h3>
        <mat-paginator #performancePaginator
                       *ngIf="relevantPreformanceReviews.length > 0"
                       [length]="relevantPreformanceReviews.length"
                       [pageSize]="pageSize"
                       [pageSizeOptions]="pageSizeOptions"
                       (page)="onPerformancePage($event)"
                       class="review-paginator">
        </mat-paginator>
        <!-- <mat-paginator *ngIf="relevantPreformanceReviews.length > 0"
                      [length]="relevantPreformanceReviews.length"
                      [pageSize]="pageSize"
                      [pageIndex]="performancePageIndex"
                      [pageSizeOptions]="pageSizeOptions"
                      (page)="onPerformancePage($event)"
                      class="review-paginator">
        </mat-paginator> -->

        <div *ngIf="this.sent_email" class="performance-reviews">
          <ul>
            <li *ngFor="let review of viewablePerformanceReviews; index as i;" class="review-item">
              <mat-icon *ngFor="let star of starArray(review.review.rating)" class=star-icon>star</mat-icon>
              <p > {{review.review.content}} </p>
              <div class="review-subtext">
                <p *ngFor="let keyword of review.keywords" > {{keyword}} </p>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>

  </div>

  <div class="column-2">
    <div class="toggle-div">
      app store <mat-slide-toggle (change)="onChange($event)"></mat-slide-toggle> play store
    </div>
    <mat-form-field>
      <mat-select placeholder="region" [(ngModel)]="selectedRegion" name="region">
        <mat-option *ngFor="let region of appStoreRegions" [value]="region">
          {{region.country}}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

</form>
